<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{/layout/layout::dynamic(~{::main})}">

<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CONVERSE || CHI TIẾT SẢN PHẨM</title>
</head>

<body>
	<main >
		<!-- mainChitietsp start -->
		<div id="mainChitietsp">
			<div class="container-fluid">
				<div class="row m-4" th:object="${productitem}">
					<div class="col-md-6">
						<div class="row">
							<div class="col-md-3">
								<div class="pictur-demo">
									<img class="image-demo"
										th:src="@{|/assets/imageSP/*{productImage1}|}" alt="hinhanh">
									<img class="image-demo"
										th:src="@{|/assets/imageSP/*{productImage2}|}" alt="hinhanh">
									<img class="image-demo"
										th:src="@{|/assets/imageSP/*{productImage3}|}" alt="hinhanh">
								</div>
							</div>
							<div class="col-md-9">
								<div class="picture-main zoom">
									<img class="image-main"
										th:src="@{|/assets/imageSP/*{productImage1}|}" alt="hinhanh">
									<img class="image-main"
										th:src="@{|/assets/imageSP/*{productImage1}|}" id="imgZoom"
										alt="hinhanh">
								</div>
							</div>
						</div>
					</div>

					<div class="col-md-6">
						<div class="picture-content">

							<h1 th:text="${productitem.productName}"></h1>
							<h2 th:unless="${promotions}" class="mt-4 mb-4">
								Giá: <span class="card-title-normal" style="font-size: 30px;"
									th:text="${#numbers.formatDecimal(productitem.price, 0, 'COMMA', 0 , 'POINT')} + ' ₫'"></span>
							</h2>
							<h2 th:if="${promotions}" class="mt-4 mb-4">
							<span >Giá:</span> <span class="card-title-old" style="font-size: 30px;"
									th:text="${#numbers.formatDecimal(productitem.price, 0, 'COMMA', 0 , 'POINT')} + ' ₫'"></span>
								 <span class="card-title-sale" style="font-size: 30px;" 
									th:text="${#numbers.formatDecimal(productitem.price*(1-promotions.discount/100), 0, 'COMMA', 0 , 'POINT')} + ' ₫'"></span>
							</h2>
							
							<p style="font-size: 25px">Mô tả:
							<div class="description mb-4"
								th:text="${productitem.productDescription}"></div>
							</p>
							<div class="row mt-4 mb-4">
								<span class="col-md-3 size1">Size:</span>
								<div class="col-md-9">
								<select  class="form-select select-custom">
                                    <option th:each="s: ${sizs}" th:text="${s.sizeNumber}">37</option>
                                </select>
									</div>
							</div>
							
							<div class="row mt-4 mb-4">
								<span class="col-md-3 size1">Màu:</span>
								<div class="col-md-9">
								<select  class="form-select select-custom">
                                    <option th:each="co: ${cols}" th:text="${co.colorName}">37</option>
                                </select>
									</div>
							</div>
							
							<div class="row mt-4 mb-4">
                            <span class="col-md-3 size1">Số lượng: </span>
                            <div class="col-md-9">
                                <input type="number" class="form-control select-custom" value="1">
                            </div>
                        	</div>


								<div class="mt-4 mb-4">
									<a href=""
										class="icon position-relative yeuthich fs-4"> <i
										class="ti-heart"></i> <span>Cho vào yêu thích</span>
									</a>
								</div>

								<div class="mt-4 mb-4">
									<a href="#" class="icon position-relative yeuthich fs-4"
										data-bs-toggle="modal" data-bs-target="#myModal"> <i
										class="ti-ruler-alt"></i> <span>Size Guide</span>
									</a>
								</div>

								<div class="mt-4 mb-4" > 
									<button th:formaction="@{/addtocart}" type="submit"
										class="btn btn-themvaogio">Thêm vào giỏ</button>
								</div>
								<!-- The Modal Start-->
								<div class="modal fade" id="myModal">
									<div class="modal-dialog modal-xl">
										<div class="modal-content">

											<!-- Modal Header -->
											<div class="modal-header">
												<h4 class="modal-title">HƯỚNG DẪN CHỌN SIZE</h4>
												<button type="button" class="btn-close"
													data-bs-dismiss="modal"></button>
											</div>

											<!-- Modal body -->
											<div class="modal-body">
												<table
													class="table table-hover text-center table-size table-striped">
													<thead>
														<tr>
															<th>SIZE</th>
															<th>UK</th>
															<th>US</th>
															<th>EU</th>
															<th>JAPAN</th>
														</tr>
													</thead>
													<tbody>
														<tr>
															<th>XS</th>
															<th>6 - 8</th>
															<th>4</th>
															<th>34.5</th>
															<th>7</th>
														</tr>
														<tr>
															<th>S</th>
															<th>8 - 10</th>
															<th>6</th>
															<th>36.5</th>
															<th>9</th>
														</tr>
														<tr>
															<th>M</th>
															<th>10 - 12</th>
															<th>8</th>
															<th>38.5</th>
															<th>11</th>
														</tr>
														<tr>
															<th>L</th>
															<th>12 - 14</th>
															<th>10</th>
															<th>40</th>
															<th>13</th>
														</tr>
														<tr>
															<th>XL</th>
															<th>14 - 16</th>
															<th>12</th>
															<th>42</th>
															<th>15</th>
														</tr>
														<tr>
															<th>XXL</th>
															<th>16 - 28</th>
															<th>14</th>
															<th>44</th>
															<th>17</th>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
								<!-- The Modal End-->
							</div>
						</div>
					</div>
					<!--                 </form> -->

				</div>
			</div>

			<!-- form bình luận start -->
			<div class="container">
    <h4 class="title-bosuutap">BÌNH LUẬN</h4>
    <form action="/submit-comment">
        <div class="form-group mb-3">
            <label for="comment">Nhập bình luận:</label>
            <textarea class="form-control" name="commentText" id="comment" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Gửi</button>
    </form>
</div>


			<!-- Hiển thị bình luận -->
			<div class="container mt-4">
				<h3>Bình luận</h3>
				<div class="media" th:each="comment : ${comments}" th:if="${comment.status == true}">
				<div class="border rounded p-3 mb-3 bg-white">
				<img th:src="@{|/assets/|}" alt="User Avatar">
				<div th:text="${comment.createDate}" style="float: right;"></div>
					<div class="media-body">
						<h5 th:text="${comment.customers.customerName}"></h5>
						<h6  th:text="${comment.comment}" style="font-weight: 500"></h6>
					</div>
					<div class="border rounded p-1" style="margin-left: 20px; background: #f7f7f7" th:if="${comment.employees.employeeName != null or comment.comment != null}">
						<img th:src="@{|/assets/|}" class="mr-3" alt="Admin Avatar">
						<div th:text="${comment.dateReply}" style="float: right;"></div>
					<div class="media-body">
						<h5 th:text="${comment.employees.employeeName}"></h5>
						<h6  th:text="${comment.adminReply}" style="font-weight: 500"></h6>
					</div>
					</div>
				</div>									
				</div>
			</div>

			<!-- form bình luận end -->

			<!-- sản phẩm tương tự start  -->

    <div class="sanphamtuongtu">
        <h4 class="title-bosuutap">SẢN PHẨM TƯƠNG TỰ</h4>
        <div class="container-fluid my-5">
            <div class="row">
                <div class="col-12 m-auto">
                    <div class="owl-carousel owl-theme">
                    <!-- 		<ul> -->

                        <div th:each="p:${productitem.categories.product}" class="item mb-4">
                            <div class="card border-0 shadow">
                                <a th:href="@{|/sanpham/chitietsp/${p.productID}|}"><img class="card-img-top" th:src="@{|/assets/imageSP/${p.productImage1}|}"
                                        alt="Card image" style="width:100%"></a>
                                <div class="card-body">
                                    <a th:href="@{|/sanpham/chitietsp/${p.productID}|}">
                                        <h4 class="card-title text-center" th:text="${p.productName}"></h4>
                                        <div class="price-product">
                               <div>
													<div
														th:unless="${p.promotionsProducts != null and p.promotionsProducts.size() > 0}">
														<h4 class="card-title">
															<span class="card-title-normal"
																th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 0 , 'POINT')} + ' ₫'"></span>
														</h4>
														<h4 class="card-title" style="color: white;">123</h4>
													</div>
													<div
														th:if="${p.promotionsProducts != null and p.promotionsProducts.size() > 0}">
														<h4 class="card-title">
															<span class="card-title-old"
																th:each="promotionProduct : ${p.promotionsProducts}"
																th:text="${#numbers.formatDecimal(promotionProduct.products.price, 0, 'COMMA', 0 , 'POINT')} + ' ₫'"></span>
														</h4>
														<h4 class="card-title">
															<span class="card-title-sale"
																th:each="promotionProduct : ${p.promotionsProducts}" 
																th:text="${#numbers.formatDecimal(promotionProduct.products.price*(1-promotionProduct.promotions.discount/100), 0, 'COMMA', 0 , 'POINT')}  + ' ₫'"></span>
														</h4>
													</div>
												</div>
											
                                    </div>
                                    </a>
                                    <div class="row d-flex justify-content-center">
                                        <a th:href="@{|/sanpham/chitietsp/${p.productID}|}" class="btn product-btn"><i class="ti-shopping-cart"></i> Chi Tiết</a>
                                        <a th:href="@{/yeuthich}" class="btn product-btn"><i class="ti-heart"></i> Yêu thích</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- sản phẩm tương tự end  -->

			<!-- mainChitietsp end -->
			<button type="button" class="btn btn-primary btn-floating btn-lg"
				id="btn-back-to-top">
				<i class="ti-angle-double-up"></i>
			</button>
	</main>

</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#commentForm").submit(function (event) {
            event.preventDefault();

            // Lấy dữ liệu từ form
            var commentContent = $("#comment").val();
            var productId = 1;  // Đổi thành mã sản phẩm thực tế
            var customerId = 2; // Đổi thành mã khách hàng thực tế
            var createDate = new Date();

            // Tạo đối tượng dữ liệu để gửi lên server
            var commentData = {
                comment: commentContent,
                productId: productId,
                customerId: customerId,
                createDate : createDate
            };

            // Gửi dữ liệu bằng POST request
            $.ajax({
                type: "POST",
                url: "/api/comments",  // Thay đổi URL tương ứng với endpoint của bạn
                data: JSON.stringify(commentData),
                contentType: "application/json",
                success: function (response) {
                    // Xử lý phản hồi từ server nếu cần
                    console.log("Bình luận đã được gửi thành công!");
                },
                error: function (error) {
                    console.error("Đã xảy ra lỗi: " + error);
                }
            });
        });
    });
</script>


</html>